<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>고급 유튜브 분석기</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c;
            color: #e2e8f0;
        }
        .container {
            max-width: 1200px;
            margin: auto;
            padding: 2rem;
        }
        .card {
            background-color: #2d3748;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.2);
        }
        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center">

<div class="container bg-gray-800 rounded-xl shadow-lg p-8">
    <div class="text-center mb-8">
        <h1 class="text-4xl font-bold mb-2">고급 유튜브 분석기</h1>
        <p class="text-gray-400">API 키, 지역, 카테고리, 그리고 표시할 영상 수를 설정하여 인기 채널을 분석합니다.</p>
        <p class="text-xs text-yellow-400 mt-2">
            ※ 참고: API 제약으로 인해 '최근 며칠간 분석' 기능은 지원되지 않습니다.
        </p>
    </div>

    <div class="flex flex-col md:flex-row items-center justify-center gap-4 mb-8">
        <input type="text" id="apiKeyInput" class="w-full px-4 py-3 rounded-lg bg-gray-700 text-white placeholder-gray-400 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="여기에 YouTube API 키를 입력하세요.">
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
        <div>
            <label for="regionSelect" class="block text-sm font-medium mb-1">지역 선택</label>
            <select id="regionSelect" class="w-full px-4 py-3 rounded-lg bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="KR">대한민국</option>
                <option value="US">미국</option>
                <option value="JP">일본</option>
                <option value="GB">영국</option>
                <option value="DE">독일</option>
            </select>
        </div>
        <div>
            <label for="categorySelect" class="block text-sm font-medium mb-1">카테고리</label>
            <select id="categorySelect" class="w-full px-4 py-3 rounded-lg bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="">전체 카테고리</option>
                <option value="1">영화 & 애니메이션</option>
                <option value="2">자동차</option>
                <option value="10">음악</option>
                <option value="17">스포츠</option>
                <option value="19">여행 & 이벤트</option>
                <option value="20">게임</option>
                <option value="22">피플 & 블로그</option>
                <option value="23">코미디</option>
                <option value="24">엔터테인먼트</option>
                <option value="25">뉴스 & 정치</option>
                <option value="26">하우투 & 스타일</option>
                <option value="27">교육</option>
                <option value="28">과학 기술</option>
            </select>
        </div>
        <div>
            <label for="videoCountInput" class="block text-sm font-medium mb-1">표시할 영상 수</label>
            <input type="number" id="videoCountInput" class="w-full px-4 py-3 rounded-lg bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500" value="10" min="1" max="50">
        </div>
    </div>

    <button id="analyzeButton" class="w-full px-6 py-3 rounded-lg bg-blue-600 hover:bg-blue-700 transition-colors duration-300 font-bold mb-8">분석하기</button>

    <div id="loading" class="hidden flex justify-center items-center py-8">
        <div class="loading-spinner"></div>
    </div>
    
    <div id="errorMessage" class="hidden bg-red-800 text-red-100 p-4 rounded-lg text-center mb-8"></div>

    <div id="results" class="hidden">
        <div id="videoList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
    </div>
</div>

<script>
    const apiKeyInput = document.getElementById('apiKeyInput');
    const regionSelect = document.getElementById('regionSelect');
    const categorySelect = document.getElementById('categorySelect');
    const videoCountInput = document.getElementById('videoCountInput');
    const analyzeButton = document.getElementById('analyzeButton');
    const loadingDiv = document.getElementById('loading');
    const errorMessageDiv = document.getElementById('errorMessage');
    const resultsDiv = document.getElementById('results');
    const videoListDiv = document.getElementById('videoList');

    analyzeButton.addEventListener('click', async () => {
        const API_KEY = apiKeyInput.value.trim();
        const regionCode = regionSelect.value;
        const videoCategoryId = categorySelect.value;
        const maxResults = videoCountInput.value;
        
        if (!API_KEY) {
            showError('API 키를 입력해주세요.');
            return;
        }
        if (maxResults < 1 || maxResults > 50) {
            showError('표시할 영상 수는 1에서 50 사이여야 합니다.');
            return;
        }

        loadingDiv.classList.remove('hidden');
        resultsDiv.classList.add('hidden');
        errorMessageDiv.classList.add('hidden');
        videoListDiv.innerHTML = '';

        try {
            let apiUrl = `https://www.googleapis.com/youtube/v3/videos?part=snippet,statistics&chart=mostPopular&regionCode=${regionCode}&maxResults=${maxResults}&key=${API_KEY}`;
            if (videoCategoryId) {
                apiUrl += `&videoCategoryId=${videoCategoryId}`;
            }

            const popularVideoResponse = await fetch(apiUrl);
            const popularVideoData = await popularVideoResponse.json();
            
            if (popularVideoData.items.length === 0) {
                showError('해당 조건에 맞는 인기 동영상을 가져올 수 없습니다.');
                return;
            }

            const videoItems = popularVideoData.items;
            const channelIds = videoItems.map(item => item.snippet.channelId);

            const channelStatsResponse = await fetch(`https://www.googleapis.com/youtube/v3/channels?part=snippet,statistics&id=${channelIds.join(',')}&key=${API_KEY}`);
            const channelStatsData = await channelStatsResponse.json();

            const channelMap = new Map();
            channelStatsData.items.forEach(channel => {
                channelMap.set(channel.id, {
                    name: channel.snippet.title,
                    subscriberCount: parseInt(channel.statistics.subscriberCount || 0).toLocaleString()
                });
            });

            videoItems.forEach(video => {
                const channelInfo = channelMap.get(video.snippet.channelId) || { name: '알 수 없음', subscriberCount: 'N/A' };
                const videoCard = document.createElement('div');
                videoCard.className = 'card';
                videoCard.innerHTML = `
                    <a href="https://www.youtube.com/watch?v=${video.id}" target="_blank" rel="noopener noreferrer">
                        <img src="${video.snippet.thumbnails.high.url}" alt="${video.snippet.title}" class="rounded-lg w-full mb-4">
                    </a>
                    <div class="text-sm text-gray-400">
                        <p class="mb-1"><strong>채널:</strong> <span class="text-blue-300 font-bold">${channelInfo.name}</span></p>
                        <p class="mb-1"><strong>구독자 수:</strong> ${channelInfo.subscriberCount}명</p>
                    </div>
                    <h3 class="text-lg font-bold text-blue-300 hover:underline mt-2">${video.snippet.title}</h3>
                    <div class="text-sm text-gray-400 mt-2">
                        <p class="mb-1"><strong>조회수:</strong> ${parseInt(video.statistics.viewCount).toLocaleString()}회</p>
                        <p class="mb-1"><strong>좋아요:</strong> ${parseInt(video.statistics.likeCount || 0).toLocaleString()}개</p>
                        <p class="mb-1"><strong>댓글 수:</strong> ${parseInt(video.statistics.commentCount || 0).toLocaleString()}개</p>
                    </div>
                `;
                videoListDiv.appendChild(videoCard);
            });

            resultsDiv.classList.remove('hidden');

        } catch (error) {
            console.error('Error fetching data:', error);
            showError('데이터를 가져오는 중 오류가 발생했습니다. API 키를 확인하거나 나중에 다시 시도해주세요.');
        } finally {
            loadingDiv.classList.add('hidden');
        }
    });

    function showError(message) {
        errorMessageDiv.textContent = message;
        errorMessageDiv.classList.remove('hidden');
    }
</script>

</body>
</html>
